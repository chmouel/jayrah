<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jayrah - Jira Web UI</title>
    <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>
    <style>
        :root {
            --primary-color: #0052cc;
            --primary-hover: #0747a6;
            --secondary-color: #f4f5f7;
            --text-color: #172b4d;
            --text-muted: #6b778c;
            --border-color: #dfe1e6;
            --shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 4px 8px rgba(0, 0, 0, 0.15);
            --success-color: #36b37e;
            --warning-color: #ffab00;
            --error-color: #de350b;
            --radius: 8px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--secondary-color);
            color: var(--text-color);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #f5deb3, #e6d2a3);
            color: #8b4513;
            padding: 0.75rem 0;
            box-shadow: var(--shadow);
            flex-shrink: 0;
        }

        .header-content {
            width: 100%;
            padding: 0 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header h1 {
            font-size: 1.4rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header-logo {
            height: 1.5rem;
            width: auto;
            object-fit: contain;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .view-toggle {
            background: rgba(139, 69, 19, 0.1);
            border: 1px solid rgba(139, 69, 19, 0.2);
            color: #8b4513;
            padding: 0.5rem;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 2.5rem;
            height: 2.5rem;
        }

        .view-toggle:hover {
            background: rgba(139, 69, 19, 0.2);
            transform: scale(1.05);
        }

        .view-toggle:active {
            transform: scale(0.95);
        }

        .layout-toggle {
            background: rgba(139, 69, 19, 0.1);
            border: 1px solid rgba(139, 69, 19, 0.2);
            color: #8b4513;
            padding: 0.5rem;
            border-radius: var(--radius);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 2.5rem;
            height: 2.5rem;
        }

        .layout-toggle:hover {
            background: rgba(139, 69, 19, 0.2);
            transform: scale(1.05);
        }

        .layout-toggle:active {
            transform: scale(0.95);
        }

        .board-selector {
            background: rgba(139, 69, 19, 0.1);
            border: 1px solid rgba(139, 69, 19, 0.2);
            color: #8b4513;
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
        }

        .board-selector:hover {
            background: rgba(139, 69, 19, 0.2);
            transform: translateY(-1px);
        }

        .board-selector:active {
            transform: translateY(0);
        }

        .search-toggle {
            background: rgba(139, 69, 19, 0.1);
            border: 1px solid rgba(139, 69, 19, 0.2);
            color: #8b4513;
            padding: 0.5rem;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 2.5rem;
            height: 2.5rem;
        }

        .search-toggle:hover {
            background: rgba(139, 69, 19, 0.2);
            transform: scale(1.05);
        }

        .search-toggle:active {
            transform: scale(0.95);
        }

        .search-toggle.active {
            background: rgba(139, 69, 19, 0.3);
            color: #654321;
        }

        .stats {
            background: rgba(139, 69, 19, 0.1);
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            font-size: 0.9rem;
        }

        /* Layout state classes */
        .layout-horizontal .main-content {
            flex-direction: row;
        }

        .layout-vertical .main-content {
            flex-direction: column;
        }

        .layout-vertical .issues-panel {
            max-height: 50vh;
            min-height: 300px;
        }

        .layout-vertical .detail-panel {
            max-height: 50vh;
        }

        /* View state classes */
        .view-list-only .detail-panel {
            display: none;
        }

        .view-details-only .issues-panel {
            display: none;
        }

        .view-both .issues-panel,
        .view-both .detail-panel {
            display: flex;
        }

        /* Ensure panels maintain proper flex behavior in all states */
        .view-list-only .issues-panel {
            display: flex;
            flex: 1;
        }

        .view-details-only .detail-panel {
            display: flex;
            flex: 1;
        }

        .container {
            display: flex;
            flex-direction: column;
            flex: 1;
            width: 100%;
            padding: 1rem 2rem;
            gap: 1rem;
            min-height: 0;
            overflow: hidden;
            /* Prevent double scrollbars */
        }

        .search-container {
            background: white;
            padding: 1rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            flex-shrink: 0;
            display: none;
            /* Hidden by default */
            animation: searchSlideDown 0.2s ease;
        }

        .search-container.visible {
            display: block;
        }

        @keyframes searchSlideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 1rem;
            transition: border-color 0.2s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 82, 204, 0.1);
        }

        #view-container {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-height: 0;
        }

        .main-content {
            display: flex;
            gap: 1rem;
            flex: 1;
            min-height: 0;
        }

        .issues-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .table-container {
            flex: 1;
            overflow: auto;
            min-height: 0;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
            min-width: 800px;
            /* Ensure horizontal scrolling */
        }

        .table th {
            background: var(--secondary-color);
            padding: 0.75rem 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 10;
            white-space: nowrap;
        }

        .table th:nth-child(1) {
            width: 60px;
        }

        /* Type */
        .table th:nth-child(2) {
            width: 120px;
        }

        /* Key */
        .table th:nth-child(3) {
            min-width: 200px;
        }

        /* Summary */
        .table th:nth-child(4) {
            width: 120px;
        }

        /* Status */
        .table th:nth-child(5) {
            width: 120px;
        }

        /* Priority */
        .table th:nth-child(6) {
            width: 140px;
        }

        /* Assignee */
        .table th:nth-child(7) {
            width: 100px;
        }

        /* Created */
        .table th:nth-child(8) {
            width: 100px;
        }

        /* Updated */

        .table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border-color);
            vertical-align: top;
            white-space: nowrap;
        }

        .table td:nth-child(3) {
            /* Summary column can wrap */
            white-space: normal;
        }

        .table tbody tr {
            transition: background-color 0.2s ease;
            cursor: pointer;
        }

        .table tbody tr:hover {
            background: rgba(139, 69, 19, 0.08);
        }

        .table tbody tr.selected {
            background: linear-gradient(135deg, rgba(245, 222, 179, 0.4), rgba(230, 210, 163, 0.4));
            border-left: 4px solid #8b4513;
            box-shadow: 0 2px 4px rgba(139, 69, 19, 0.1);
        }

        .issue-type {
            font-size: 1.2rem;
            display: inline-block;
            width: 2rem;
            text-align: center;
        }

        .issue-key {
            font-family: 'Monaco', 'Menlo', monospace;
            font-weight: 600;
            color: var(--primary-color);
            text-decoration: none;
        }

        .issue-key:hover {
            text-decoration: underline;
        }

        .issue-summary {
            font-weight: 500;
            min-width: 200px;
            max-width: 400px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-todo {
            background: #e6f3ff;
            color: #0052cc;
        }

        .status-progress {
            background: #fff7e6;
            color: #ff8b00;
        }

        .status-review {
            background: #f3e6ff;
            color: #6554c0;
        }

        .status-done {
            background: #e6ffed;
            color: #00875a;
        }

        .status-default {
            background: var(--secondary-color);
            color: var(--text-muted);
        }

        .user-avatar {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .date {
            font-size: 0.875rem;
            color: var(--text-muted);
        }

        .detail-panel {
            flex: 1;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .detail-panel.empty {
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            font-style: italic;
        }

        .detail-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            background: var(--secondary-color);
            flex-shrink: 0;
        }

        .detail-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--text-muted);
            padding: 0.25rem;
            border-radius: var(--radius);
            transition: background-color 0.2s ease;
        }

        .close-btn:hover {
            background: var(--border-color);
        }

        .detail-content {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
        }

        .detail-section {
            margin-bottom: 1.5rem;
        }

        .detail-section h3 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--text-color);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.5rem;
        }

        .detail-field {
            display: grid;
            grid-template-columns: 120px 1fr;
            gap: 1rem;
            margin-bottom: 0.75rem;
            align-items: start;
        }

        .detail-label {
            font-weight: 600;
            color: var(--text-muted);
            font-size: 0.875rem;
        }

        .detail-value {
            color: var(--text-color);
        }

        .detail-description {
            background: var(--secondary-color);
            padding: 1rem;
            border-radius: var(--radius);
            border-left: 4px solid var(--primary-color);
            margin-top: 0.5rem;
            line-height: 1.6;
        }

        .detail-description h1,
        .detail-description h2,
        .detail-description h3,
        .detail-description h4,
        .detail-description h5,
        .detail-description h6 {
            margin: 1em 0 0.5em 0;
            color: var(--text-color);
        }

        .detail-description h1:first-child,
        .detail-description h2:first-child,
        .detail-description h3:first-child,
        .detail-description h4:first-child,
        .detail-description h5:first-child,
        .detail-description h6:first-child {
            margin-top: 0;
        }

        .detail-description p {
            margin: 0.75em 0;
        }

        .detail-description ul,
        .detail-description ol {
            margin: 0.75em 0;
            padding-left: 2em;
        }

        .detail-description li {
            margin: 0.25em 0;
        }

        .detail-description pre {
            background: #f8f9fa;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 1rem;
            overflow-x: auto;
            margin: 1em 0;
        }

        .detail-description code {
            background: #f8f9fa;
            border: 1px solid var(--border-color);
            border-radius: 3px;
            padding: 0.2em 0.4em;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9em;
        }

        .detail-description pre code {
            background: none;
            border: none;
            padding: 0;
        }

        .detail-description blockquote {
            border-left: 4px solid var(--border-color);
            margin: 1em 0;
            padding-left: 1em;
            color: var(--text-muted);
        }

        .detail-description a {
            color: var(--primary-color);
            text-decoration: none;
        }

        .detail-description a:hover {
            text-decoration: underline;
        }

        .detail-labels {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .label-tag {
            background: var(--primary-color);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .detail-link {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }

        .detail-link:hover {
            text-decoration: underline;
        }

        .raw-json-toggle {
            background: var(--secondary-color);
            border: 1px solid var(--border-color);
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            font-size: 0.875rem;
            cursor: pointer;
            margin-top: 1rem;
        }

        .raw-json-toggle:hover {
            background: var(--border-color);
        }

        .raw-json {
            display: none;
            white-space: pre-wrap;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.75rem;
            background: var(--secondary-color);
            padding: 1rem;
            border-radius: var(--radius);
            overflow-x: auto;
            margin-top: 1rem;
            max-height: 400px;
            overflow-y: auto;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--text-muted);
        }

        .no-issues {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
        }

        @media (max-width: 1024px) {
            .main-content {
                flex-direction: column;
            }

            .issues-panel {
                max-height: 50vh;
                min-height: 300px;
            }

            /* Auto-switch to column layout on tablet sizes */
            .view-both .main-content {
                flex-direction: column;
            }

            .view-both .issues-panel {
                max-height: 45vh;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 0.5rem;
            }

            .header-content {
                padding: 0 1rem;
                flex-direction: column;
                gap: 1rem;
            }

            .table {
                font-size: 0.75rem;
                min-width: 600px;
                /* Maintain horizontal scroll on mobile */
            }

            .table th,
            .table td {
                padding: 0.5rem;
            }

            .issue-summary {
                min-width: 150px;
                max-width: 250px;
            }

            .user-avatar span {
                display: none;
            }

            /* On mobile, optimize panel heights */
            .view-both .main-content {
                flex-direction: column;
            }

            .view-both .detail-panel {
                max-height: 40vh;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* Help overlay styles */
        .help-overlay {
            animation: fadeIn 0.2s ease;
        }

        .help-overlay kbd {
            background: var(--secondary-color);
            border: 1px solid var(--border-color);
            border-radius: 3px;
            padding: 0.2rem 0.4rem;
            font-size: 0.8rem;
            font-weight: bold;
            color: var(--primary-color);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .help-overlay strong {
            color: var(--primary-color);
            grid-column: 1 / -1;
            margin-top: 0.5rem;
        }

        .help-overlay strong:first-child {
            margin-top: 0;
        }
    </style>
</head>

<body>
    <header class="header">
        <div class="header-content">
            <h1><img src="/images/jayrah.png" alt="Jayrah" class="header-logo"> Jayrah - Jira Web UI</h1>
            <div class="header-controls">
                <button class="board-selector" id="board-selector" title="Switch board (Press B)">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <rect x="2" y="3" width="12" height="10" rx="1" stroke="currentColor" stroke-width="1"
                            fill="none" />
                        <rect x="3" y="4" width="10" height="1" fill="currentColor" />
                        <rect x="3" y="6" width="4" height="1" fill="currentColor" />
                        <rect x="9" y="6" width="4" height="1" fill="currentColor" />
                        <rect x="3" y="8" width="4" height="1" fill="currentColor" />
                        <rect x="9" y="8" width="4" height="1" fill="currentColor" />
                        <rect x="3" y="10" width="4" height="1" fill="currentColor" />
                        <rect x="9" y="10" width="4" height="1" fill="currentColor" />
                        <line x1="7.5" y1="5" x2="7.5" y2="11" stroke="currentColor" stroke-width="1" />
                    </svg>
                    Board
                </button>
                <button class="search-toggle" id="search-toggle" title="Toggle search (Press /)">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <circle cx="6.5" cy="6.5" r="4" stroke="currentColor" stroke-width="1.5" fill="none" />
                        <line x1="9.5" y1="9.5" x2="13" y2="13" stroke="currentColor" stroke-width="1.5"
                            stroke-linecap="round" />
                    </svg>
                </button>
                <button class="layout-toggle" id="layout-toggle" title="Toggle layout (Press V)">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <rect x="1" y="3" width="6" height="10" rx="1" stroke="currentColor" stroke-width="1"
                            fill="none" />
                        <rect x="9" y="3" width="6" height="10" rx="1" stroke="currentColor" stroke-width="1"
                            fill="none" />
                        <rect x="2" y="4" width="4" height="1" fill="currentColor" />
                        <rect x="2" y="6" width="4" height="1" fill="currentColor" />
                        <rect x="2" y="8" width="3" height="1" fill="currentColor" />
                        <rect x="10" y="4" width="4" height="1" fill="currentColor" />
                        <rect x="10" y="6" width="4" height="1" fill="currentColor" />
                        <rect x="10" y="8" width="4" height="1" fill="currentColor" />
                        <rect x="10" y="10" width="3" height="1" fill="currentColor" />
                    </svg>
                </button>
                <button class="view-toggle" id="view-toggle" title="Toggle view mode (Press T)">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <rect x="1" y="2" width="6" height="12" rx="1" stroke="currentColor" stroke-width="1"
                            fill="none" />
                        <rect x="9" y="4" width="6" height="10" rx="1" stroke="currentColor" stroke-width="1"
                            fill="none" />
                        <rect x="2" y="3" width="4" height="1" fill="currentColor" />
                        <rect x="2" y="5" width="4" height="1" fill="currentColor" />
                        <rect x="2" y="7" width="3" height="1" fill="currentColor" />
                        <rect x="10" y="5" width="4" height="1" fill="currentColor" />
                        <rect x="10" y="7" width="4" height="1" fill="currentColor" />
                        <rect x="10" y="9" width="3" height="1" fill="currentColor" />
                    </svg>
                </button>
                <div class="stats" id="stats">Loading...</div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="search-container">
            <input type="text" id="search" class="search-input"
                placeholder="Search issues by key, summary, assignee, status..." />
        </div>

        <div id="view-container" class="view-both">
            <div class="main-content">
                <div class="issues-panel">
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Type</th>
                                    <th>Key</th>
                                    <th>Summary</th>
                                    <th>Status</th>
                                    <th>Assignee</th>
                                    <th>Reporter</th>
                                    <th>Created</th>
                                    <th>Updated</th>
                                </tr>
                            </thead>
                            <tbody id="issues-tbody">
                                <tr>
                                    <td colspan="8" class="loading">Loading issues...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="detail-panel" class="detail-panel empty">
                    <div style="text-align: center; color: var(--text-muted);">
                        üìã Select an issue to view details
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let allIssues = [];
        let selectedRow = null;
        let jiraBaseUrl = null;
        let availableBoards = [];
        let currentBoard = null;

        // Layout state management
        const LAYOUT_STATES = {
            HORIZONTAL: 'layout-horizontal',
            VERTICAL: 'layout-vertical'
        };

        let currentLayoutState = LAYOUT_STATES.HORIZONTAL;

        // View state management
        const VIEW_STATES = {
            BOTH: 'view-both',
            LIST_ONLY: 'view-list-only',
            DETAILS_ONLY: 'view-details-only'
        };

        const VIEW_ICONS = {
            [VIEW_STATES.BOTH]: `
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <rect x="1" y="2" width="6" height="12" rx="1" stroke="currentColor" stroke-width="1" fill="none"/>
                    <rect x="9" y="4" width="6" height="10" rx="1" stroke="currentColor" stroke-width="1" fill="none"/>
                    <rect x="2" y="3" width="4" height="1" fill="currentColor"/>
                    <rect x="2" y="5" width="4" height="1" fill="currentColor"/>
                    <rect x="2" y="7" width="3" height="1" fill="currentColor"/>
                    <rect x="10" y="5" width="4" height="1" fill="currentColor"/>
                    <rect x="10" y="7" width="4" height="1" fill="currentColor"/>
                    <rect x="10" y="9" width="3" height="1" fill="currentColor"/>
                </svg>
            `,
            [VIEW_STATES.LIST_ONLY]: `
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <rect x="2" y="2" width="12" height="12" rx="1" stroke="currentColor" stroke-width="1" fill="none"/>
                    <rect x="3" y="3" width="10" height="1" fill="currentColor"/>
                    <rect x="3" y="5" width="10" height="1" fill="currentColor"/>
                    <rect x="3" y="7" width="8" height="1" fill="currentColor"/>
                    <rect x="3" y="9" width="10" height="1" fill="currentColor"/>
                    <rect x="3" y="11" width="7" height="1" fill="currentColor"/>
                </svg>
            `,
            [VIEW_STATES.DETAILS_ONLY]: `
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <rect x="4" y="2" width="8" height="12" rx="1" stroke="currentColor" stroke-width="1" fill="none"/>
                    <rect x="5" y="3" width="6" height="1" fill="currentColor"/>
                    <rect x="5" y="5" width="6" height="1" fill="currentColor"/>
                    <rect x="5" y="7" width="5" height="1" fill="currentColor"/>
                    <rect x="5" y="9" width="6" height="1" fill="currentColor"/>
                    <rect x="5" y="11" width="4" height="1" fill="currentColor"/>
                </svg>
            `
        };

        // Layout toggle icons (SVG)
        const LAYOUT_ICONS = {
            [LAYOUT_STATES.HORIZONTAL]: `
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <rect x="1" y="3" width="6" height="10" rx="1" stroke="currentColor" stroke-width="1" fill="none"/>
                    <rect x="9" y="3" width="6" height="10" rx="1" stroke="currentColor" stroke-width="1" fill="none"/>
                    <rect x="2" y="4" width="4" height="1" fill="currentColor"/>
                    <rect x="2" y="6" width="4" height="1" fill="currentColor"/>
                    <rect x="2" y="8" width="3" height="1" fill="currentColor"/>
                    <rect x="10" y="4" width="4" height="1" fill="currentColor"/>
                    <rect x="10" y="6" width="4" height="1" fill="currentColor"/>
                    <rect x="10" y="8" width="4" height="1" fill="currentColor"/>
                    <rect x="10" y="10" width="3" height="1" fill="currentColor"/>
                </svg>
            `,
            [LAYOUT_STATES.VERTICAL]: `
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <rect x="3" y="1" width="10" height="5" rx="1" stroke="currentColor" stroke-width="1" fill="none"/>
                    <rect x="3" y="8" width="10" height="7" rx="1" stroke="currentColor" stroke-width="1" fill="none"/>
                    <rect x="4" y="2" width="4" height="1" fill="currentColor"/>
                    <rect x="4" y="3.5" width="4" height="1" fill="currentColor"/>
                    <rect x="4" y="5" width="3" height="1" fill="currentColor"/>
                    <rect x="4" y="9" width="4" height="1" fill="currentColor"/>
                    <rect x="4" y="10.5" width="4" height="1" fill="currentColor"/>
                    <rect x="4" y="12" width="4" height="1" fill="currentColor"/>
                    <rect x="4" y="13.5" width="3" height="1" fill="currentColor"/>
                </svg>
            `
        };

        const LAYOUT_TITLES = {
            [LAYOUT_STATES.HORIZONTAL]: 'Current layout: horizontal (side by side) - click or press V to switch to vertical',
            [LAYOUT_STATES.VERTICAL]: 'Current layout: vertical (top/bottom) - click or press V to switch to horizontal'
        };

        const VIEW_TITLES = {
            [VIEW_STATES.BOTH]: 'Showing both panels - click or press T to show list only',
            [VIEW_STATES.LIST_ONLY]: 'Showing list only - click or press T to show details only',
            [VIEW_STATES.DETAILS_ONLY]: 'Showing details only - click or press T to show both panels'
        };

        let currentViewState = VIEW_STATES.BOTH;

        // Toggle layout state
        function toggleLayoutState() {
            const container = document.getElementById('view-container');
            const layoutToggleBtn = document.getElementById('layout-toggle');

            // Remove current layout class
            container.classList.remove(currentLayoutState);

            // Toggle between horizontal and vertical
            currentLayoutState = currentLayoutState === LAYOUT_STATES.HORIZONTAL
                ? LAYOUT_STATES.VERTICAL
                : LAYOUT_STATES.HORIZONTAL;

            // Apply new layout
            container.classList.add(currentLayoutState);

            // Update button icon and title
            if (layoutToggleBtn) {
                layoutToggleBtn.innerHTML = LAYOUT_ICONS[currentLayoutState];
                layoutToggleBtn.title = LAYOUT_TITLES[currentLayoutState];
            }

            // Store preference in localStorage
            localStorage.setItem('jayrah-layout-state', currentLayoutState);

            // Show notification
            const layoutName = currentLayoutState === LAYOUT_STATES.HORIZONTAL ? 'horizontal (side by side)' : 'vertical (top/bottom)';
            showNotification(`Layout changed to ${layoutName}`);
        }

        // Initialize layout state from localStorage or default
        function initializeLayoutState() {
            const savedLayout = localStorage.getItem('jayrah-layout-state');
            if (savedLayout && Object.values(LAYOUT_STATES).includes(savedLayout)) {
                currentLayoutState = savedLayout;
            }

            const container = document.getElementById('view-container');
            const layoutToggleBtn = document.getElementById('layout-toggle');

            container.classList.add(currentLayoutState);

            // Initialize button icon and title
            if (layoutToggleBtn) {
                layoutToggleBtn.innerHTML = LAYOUT_ICONS[currentLayoutState];
                layoutToggleBtn.title = LAYOUT_TITLES[currentLayoutState];
            }
        }

        // Toggle view state
        function toggleViewState() {
            const container = document.getElementById('view-container');
            const toggleBtn = document.getElementById('view-toggle');

            // Remove current state class
            container.classList.remove(currentViewState);

            // Cycle through states
            switch (currentViewState) {
                case VIEW_STATES.BOTH:
                    currentViewState = VIEW_STATES.LIST_ONLY;
                    break;
                case VIEW_STATES.LIST_ONLY:
                    currentViewState = VIEW_STATES.DETAILS_ONLY;
                    break;
                case VIEW_STATES.DETAILS_ONLY:
                    currentViewState = VIEW_STATES.BOTH;
                    break;
            }

            // Apply new state
            container.classList.add(currentViewState);
            toggleBtn.innerHTML = VIEW_ICONS[currentViewState];
            toggleBtn.title = VIEW_TITLES[currentViewState];

            // Store preference in localStorage
            localStorage.setItem('jayrah-view-state', currentViewState);
        }        // Initialize view state from localStorage or default
        function initializeViewState() {
            const savedState = localStorage.getItem('jayrah-view-state');
            if (savedState && Object.values(VIEW_STATES).includes(savedState)) {
                currentViewState = savedState;
            }

            const container = document.getElementById('view-container');
            const toggleBtn = document.getElementById('view-toggle');

            container.classList.add(currentViewState);
            toggleBtn.innerHTML = VIEW_ICONS[currentViewState];
            toggleBtn.title = VIEW_TITLES[currentViewState];
        }

        // Navigation functions for keyboard shortcuts
        function navigateIssueList(direction = 'down') {
            const tbody = document.getElementById('issues-tbody');
            const rows = Array.from(tbody.querySelectorAll('tr')).filter(row =>
                !row.querySelector('.loading') && !row.querySelector('.no-issues')
            );

            if (rows.length === 0) return;

            let currentIndex = -1;
            if (selectedRow) {
                currentIndex = rows.findIndex(row => row === selectedRow);
            }

            let newIndex;
            if (direction === 'down') {
                newIndex = currentIndex + 1;
                if (newIndex >= rows.length) newIndex = 0; // Wrap to top
            } else {
                newIndex = currentIndex - 1;
                if (newIndex < 0) newIndex = rows.length - 1; // Wrap to bottom
            }

            const newRow = rows[newIndex];
            if (newRow) {
                // Extract issue key from the row
                const keyCell = newRow.querySelector('td:nth-child(2) a');
                if (keyCell) {
                    const issueKey = keyCell.textContent.trim();
                    selectRow(newRow, issueKey);

                    // Scroll row into view
                    newRow.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            }
        }

        function scrollDetailPanel(direction) {
            const detailContent = document.querySelector('.detail-content');
            if (!detailContent) return;

            const scrollAmount = 100; // pixels to scroll
            const currentScroll = detailContent.scrollTop;

            if (direction === 'down') {
                detailContent.scrollTo({
                    top: currentScroll + scrollAmount,
                    behavior: 'smooth'
                });
            } else {
                detailContent.scrollTo({
                    top: currentScroll - scrollAmount,
                    behavior: 'smooth'
                });
            }
        }

        function openSelectedIssueInNewTab() {
            if (!selectedRow) {
                // If no row selected, try to select the first one
                const tbody = document.getElementById('issues-tbody');
                const firstRow = tbody.querySelector('tr:not(.loading):not(.no-issues)');
                if (firstRow) {
                    const keyCell = firstRow.querySelector('td:nth-child(2) a');
                    if (keyCell) {
                        const issueKey = keyCell.textContent.trim();
                        selectRow(firstRow, issueKey);
                    }
                }
            }

            if (selectedRow) {
                const keyCell = selectedRow.querySelector('td:nth-child(2) a');
                if (keyCell) {
                    const issueKey = keyCell.textContent.trim();
                    const jiraBaseUrl = getJiraBaseUrl();
                    if (jiraBaseUrl) {
                        const issueUrl = `${jiraBaseUrl}/browse/${issueKey}`;
                        window.open(issueUrl, '_blank');
                        showNotification(`Opened ${issueKey} in new tab`);
                    } else {
                        showNotification('Error: Jira base URL not configured', 'error');
                    }
                }
            } else {
                showNotification('No issue selected', 'error');
            }
        }

        function yankIssueUrl() {
            if (!selectedRow) {
                // If no row selected, try to select the first one
                const tbody = document.getElementById('issues-tbody');
                const firstRow = tbody.querySelector('tr:not(.loading):not(.no-issues)');
                if (firstRow) {
                    const keyCell = firstRow.querySelector('td:nth-child(2) a');
                    if (keyCell) {
                        const issueKey = keyCell.textContent.trim();
                        selectRow(firstRow, issueKey);
                    }
                }
            }

            if (selectedRow) {
                const keyCell = selectedRow.querySelector('td:nth-child(2) a');
                if (keyCell) {
                    const issueKey = keyCell.textContent.trim();
                    const jiraBaseUrl = getJiraBaseUrl();
                    if (jiraBaseUrl) {
                        const issueUrl = `${jiraBaseUrl}/browse/${issueKey}`;
                        navigator.clipboard.writeText(issueUrl).then(() => {
                            showNotification(`Copied ${issueKey} URL to clipboard`);
                        }).catch(() => {
                            showNotification(`Failed to copy URL for ${issueKey}`, 'error');
                        });
                    } else {
                        // Fallback: copy just the issue key
                        navigator.clipboard.writeText(issueKey).then(() => {
                            showNotification(`Copied issue key ${issueKey} to clipboard`);
                        }).catch(() => {
                            showNotification(`Failed to copy issue key ${issueKey}`, 'error');
                        });
                    }
                }
            } else {
                showNotification('No issue selected', 'error');
            }
        }

        function showHelpOverlay() {
            // Remove existing overlay if it exists
            const existingOverlay = document.getElementById('help-overlay');
            if (existingOverlay) {
                existingOverlay.remove();
            }

            // Create new help overlay
            const overlay = document.createElement('div');
            overlay.id = 'help-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background-color: rgba(0, 0, 0, 0.7);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                animation: fadeIn 0.2s ease;
            `;

            const helpContent = document.createElement('div');
            helpContent.style.cssText = `
                background: #ffffff;
                color: #333333;
                border: 1px solid #e1e4e8;
                border-radius: 8px;
                padding: 2rem;
                max-width: 550px;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                margin: 1rem;
            `;

            helpContent.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; border-bottom: 1px solid #e1e4e8; padding-bottom: 1rem;">
                    <h2 style="margin: 0; color: #0366d6; font-size: 1.25rem;">üöÄ Jayrah Keyboard Shortcuts</h2>
                    <button id="close-help" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #6a737d; padding: 0.25rem;">&times;</button>
                </div>
                
                <div style="margin-bottom: 1.5rem;">
                    <h3 style="margin: 0 0 0.75rem 0; color: #0366d6; font-size: 1rem; border-bottom: 1px solid #f1f3f4; padding-bottom: 0.5rem;">üìã Navigation</h3>
                    <div style="display: grid; grid-template-columns: auto 1fr; gap: 0.5rem 1rem; margin-bottom: 1rem;">
                        <kbd style="background: #f6f8fa; border: 1px solid #d1d5da; border-radius: 3px; padding: 0.2rem 0.4rem; font-size: 0.8rem; font-weight: bold; color: #24292e;">j</kbd>
                        <span style="color: #586069;">Move down in issue list</span>
                        <kbd style="background: #f6f8fa; border: 1px solid #d1d5da; border-radius: 3px; padding: 0.2rem 0.4rem; font-size: 0.8rem; font-weight: bold; color: #24292e;">k</kbd>
                        <span style="color: #586069;">Move up in issue list</span>
                        <kbd style="background: #f6f8fa; border: 1px solid #d1d5da; border-radius: 3px; padding: 0.2rem 0.4rem; font-size: 0.8rem; font-weight: bold; color: #24292e;">Page Down</kbd>
                        <span style="color: #586069;">Jump down ~10 issues</span>
                        <kbd style="background: #f6f8fa; border: 1px solid #d1d5da; border-radius: 3px; padding: 0.2rem 0.4rem; font-size: 0.8rem; font-weight: bold; color: #24292e;">Page Up</kbd>
                        <span style="color: #586069;">Jump up ~10 issues</span>
                        <kbd style="background: #f6f8fa; border: 1px solid #d1d5da; border-radius: 3px; padding: 0.2rem 0.4rem; font-size: 0.8rem; font-weight: bold; color: #24292e;">Home</kbd>
                        <span style="color: #586069;">Go to first issue</span>
                        <kbd style="background: #f6f8fa; border: 1px solid #d1d5da; border-radius: 3px; padding: 0.2rem 0.4rem; font-size: 0.8rem; font-weight: bold; color: #24292e;">End</kbd>
                        <span style="color: #586069;">Go to last issue</span>
                        <kbd style="background: #f6f8fa; border: 1px solid #d1d5da; border-radius: 3px; padding: 0.2rem 0.4rem; font-size: 0.8rem; font-weight: bold; color: #24292e;">J</kbd>
                        <span style="color: #586069;">Scroll detail panel down</span>
                        <kbd style="background: #f6f8fa; border: 1px solid #d1d5da; border-radius: 3px; padding: 0.2rem 0.4rem; font-size: 0.8rem; font-weight: bold; color: #24292e;">K</kbd>
                        <span style="color: #586069;">Scroll detail panel up</span>
                        <kbd style="background: #f6f8fa; border: 1px solid #d1d5da; border-radius: 3px; padding: 0.2rem 0.4rem; font-size: 0.8rem; font-weight: bold; color: #24292e;">Shift+Page Down</kbd>
                        <span style="color: #586069;">Scroll detail panel down (page)</span>
                        <kbd style="background: #f6f8fa; border: 1px solid #d1d5da; border-radius: 3px; padding: 0.2rem 0.4rem; font-size: 0.8rem; font-weight: bold; color: #24292e;">Shift+Page Up</kbd>
                        <span style="color: #586069;">Scroll detail panel up (page)</span>
                        <kbd style="background: #f6f8fa; border: 1px solid #d1d5da; border-radius: 3px; padding: 0.2rem 0.4rem; font-size: 0.8rem; font-weight: bold; color: #24292e;">Space</kbd>
                        <span style="color: #586069;">Scroll detail panel down (page)</span>
                        <kbd style="background: #f6f8fa; border: 1px solid #d1d5da; border-radius: 3px; padding: 0.2rem 0.4rem; font-size: 0.8rem; font-weight: bold; color: #24292e;">Shift+Space</kbd>
                        <span style="color: #586069;">Scroll detail panel up (page)</span>
                    </div>
                </div>
                
                <div style="margin-bottom: 1.5rem;">
                    <h3 style="margin: 0 0 0.75rem 0; color: #0366d6; font-size: 1rem; border-bottom: 1px solid #f1f3f4; padding-bottom: 0.5rem;">‚ö° Actions</h3>
                    <div style="display: grid; grid-template-columns: auto 1fr; gap: 0.5rem 1rem; margin-bottom: 1rem;">
                        <kbd style="background: #f6f8fa; border: 1px solid #d1d5da; border-radius: 3px; padding: 0.2rem 0.4rem; font-size: 0.8rem; font-weight: bold; color: #24292e;">o</kbd>
                        <span style="color: #586069;">Open selected issue in new Jira tab</span>
                        <kbd style="background: #f6f8fa; border: 1px solid #d1d5da; border-radius: 3px; padding: 0.2rem 0.4rem; font-size: 0.8rem; font-weight: bold; color: #24292e;">y</kbd>
                        <span style="color: #586069;">Yank (copy) issue URL to clipboard</span>
                    </div>
                </div>
                
                <div style="margin-bottom: 1.5rem;">
                    <h3 style="margin: 0 0 0.75rem 0; color: #0366d6; font-size: 1rem; border-bottom: 1px solid #f1f3f4; padding-bottom: 0.5rem;">üëÅÔ∏è View & Navigation</h3>
                    <div style="display: grid; grid-template-columns: auto 1fr; gap: 0.5rem 1rem; margin-bottom: 1rem;">
                        <kbd style="background: #f6f8fa; border: 1px solid #d1d5da; border-radius: 3px; padding: 0.2rem 0.4rem; font-size: 0.8rem; font-weight: bold; color: #24292e;">t</kbd>
                        <span style="color: #586069;">Toggle view mode (list/detail/both)</span>
                        <kbd style="background: #f6f8fa; border: 1px solid #d1d5da; border-radius: 3px; padding: 0.2rem 0.4rem; font-size: 0.8rem; font-weight: bold; color: #24292e;">v</kbd>
                        <span style="color: #586069;">Toggle layout (horizontal/vertical)</span>
                        <kbd style="background: #f6f8fa; border: 1px solid #d1d5da; border-radius: 3px; padding: 0.2rem 0.4rem; font-size: 0.8rem; font-weight: bold; color: #24292e;">b</kbd>
                        <span style="color: #586069;">Switch board</span>
                        <kbd style="background: #f6f8fa; border: 1px solid #d1d5da; border-radius: 3px; padding: 0.2rem 0.4rem; font-size: 0.8rem; font-weight: bold; color: #24292e;">/</kbd>
                        <span style="color: #586069;">Toggle search bar</span>
                    </div>
                </div>
                
                <div style="margin-bottom: 1.5rem;">
                    <h3 style="margin: 0 0 0.75rem 0; color: #0366d6; font-size: 1rem; border-bottom: 1px solid #f1f3f4; padding-bottom: 0.5rem;">‚ùì Help</h3>
                    <div style="display: grid; grid-template-columns: auto 1fr; gap: 0.5rem 1rem; margin-bottom: 1rem;">
                        <kbd style="background: #f6f8fa; border: 1px solid #d1d5da; border-radius: 3px; padding: 0.2rem 0.4rem; font-size: 0.8rem; font-weight: bold; color: #24292e;">?</kbd>
                        <span style="color: #586069;">Show this help overlay</span>
                        <kbd style="background: #f6f8fa; border: 1px solid #d1d5da; border-radius: 3px; padding: 0.2rem 0.4rem; font-size: 0.8rem; font-weight: bold; color: #24292e;">Esc</kbd>
                        <span style="color: #586069;">Close detail panel or help overlay</span>
                    </div>
                </div>
                
                <div style="padding-top: 1rem; border-top: 1px solid #e1e4e8; color: #6a737d; font-size: 0.875rem;">
                    <p style="margin: 0 0 0.5rem 0; font-weight: 600; color: #24292e;">üí° Tips:</p>
                    <ul style="margin: 0; padding-left: 1.2rem; line-height: 1.4;">
                        <li style="margin-bottom: 0.25rem;">Press '/' or click üîç to toggle the search bar</li>
                        <li style="margin-bottom: 0.25rem;">Use the search box to filter issues by key, summary, assignee, or status</li>
                        <li style="margin-bottom: 0.25rem;">Click on any issue to view its details</li>
                        <li style="margin-bottom: 0.25rem;">Press 'v' to toggle between horizontal (side by side) and vertical (top/bottom) layouts</li>
                        <li style="margin-bottom: 0.25rem;">Navigation wraps around (j at bottom goes to top, k at top goes to bottom)</li>
                        <li style="margin-bottom: 0.25rem;">Page Up/Down jump ~10 issues; Home/End go to first/last issue</li>
                        <li style="margin-bottom: 0.25rem;">Use Shift+Page Up/Down for fast detail panel scrolling</li>
                        <li style="margin-bottom: 0;">All shortcuts work except when typing in search box</li>
                    </ul>
                </div>
            `;

            overlay.appendChild(helpContent);
            document.body.appendChild(overlay);

            // Close on click outside or close button
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    hideHelpOverlay();
                }
            });

            const closeBtn = helpContent.querySelector('#close-help');
            if (closeBtn) {
                closeBtn.addEventListener('click', hideHelpOverlay);
            }
        }

        function hideHelpOverlay() {
            const overlay = document.getElementById('help-overlay');
            if (overlay) {
                overlay.remove();
            }
        }

        function openIssueInTab(issueKey) {
            const jiraBaseUrl = getJiraBaseUrl();
            if (jiraBaseUrl) {
                const issueUrl = `${jiraBaseUrl}/browse/${issueKey}`;
                window.open(issueUrl, '_blank');
                showNotification(`Opened ${issueKey} in new tab`);
            } else {
                showNotification('Error: Jira base URL not configured', 'error');
            }
        }

        function getJiraBaseUrl() {
            return jiraBaseUrl;
        }

        async function loadConfig() {
            try {
                const res = await fetch('/api/config');
                if (res.ok) {
                    const config = await res.json();
                    jiraBaseUrl = config.jira_base_url;
                }
            } catch (error) {
                console.error('Error loading config:', error);
            }
        }

        function showNotification(message, type = 'success') {
            // Create a simple notification
            const notification = document.createElement('div');
            let bgColor = 'var(--primary-color)';
            if (type === 'success') {
                bgColor = 'var(--success-color)';
            } else if (type === 'error') {
                bgColor = '#dc3545'; // Red for errors
            }

            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${bgColor};
                color: white;
                padding: 0.75rem 1rem;
                border-radius: var(--radius);
                box-shadow: var(--shadow);
                z-index: 1000;
                font-size: 0.875rem;
                max-width: 300px;
            `;
            notification.textContent = message;

            document.body.appendChild(notification);

            // Remove after 3 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }

        // Convert Jira markup to standard markdown
        function convertJiraToMarkdown(text) {
            if (!text) return '';

            // Handle different text formats
            if (typeof text === 'object') {
                // If it's an object, try to extract text content
                if (text.content) {
                    // Handle ADF (Atlassian Document Format)
                    return extractTextFromADF(text);
                } else if (text.raw) {
                    text = text.raw;
                } else {
                    text = JSON.stringify(text);
                }
            }

            // Convert Jira markup to standard markdown
            let markdown = text.toString();

            // Headers: h1. -> #, h2. -> ##, etc.
            markdown = markdown.replace(/^h([1-6])\.\s+(.+)$/gm, (match, level, content) => {
                return '#'.repeat(parseInt(level)) + ' ' + content;
            });

            // Bold: *text* -> **text**
            markdown = markdown.replace(/\*([^*]+)\*/g, '**$1**');

            // Italic: _text_ -> *text*
            markdown = markdown.replace(/_([^_]+)_/g, '*$1*');

            // Code blocks: {code} -> ```
            markdown = markdown.replace(/\{code(?::([^}]*))?\}([\s\S]*?)\{code\}/g, (match, lang, code) => {
                return '```' + (lang || '') + '\n' + code.trim() + '\n```';
            });

            // Inline code: {{text}} -> `text`
            markdown = markdown.replace(/\{\{([^}]+)\}\}/g, '`$1`');

            // Links: [text|url] -> [text](url)
            markdown = markdown.replace(/\[([^|\]]+)\|([^\]]+)\]/g, '[$1]($2)');

            // Lists: * item -> - item (already compatible)
            // Numbers: # item -> 1. item
            markdown = markdown.replace(/^#\s+(.+)$/gm, '1. $1');

            // Line breaks: Convert \r\n or \n to proper breaks
            markdown = markdown.replace(/\r\n/g, '\n');

            return markdown;
        }

        // Extract text from Atlassian Document Format (ADF)
        function extractTextFromADF(adf) {
            if (!adf || typeof adf !== 'object') return '';

            let text = '';

            if (adf.type === 'text') {
                text = adf.text || '';
                // Apply marks if present
                if (adf.marks) {
                    adf.marks.forEach(mark => {
                        if (mark.type === 'strong') text = `**${text}**`;
                        if (mark.type === 'em') text = `*${text}*`;
                        if (mark.type === 'code') text = `\`${text}\``;
                        if (mark.type === 'link') text = `[${text}](${mark.attrs?.href || ''})`;
                    });
                }
            } else if (adf.type === 'paragraph') {
                if (adf.content) {
                    text = adf.content.map(extractTextFromADF).join('') + '\n\n';
                }
            } else if (adf.type === 'heading') {
                const level = adf.attrs?.level || 1;
                if (adf.content) {
                    text = '#'.repeat(level) + ' ' + adf.content.map(extractTextFromADF).join('') + '\n\n';
                }
            } else if (adf.type === 'codeBlock') {
                const lang = adf.attrs?.language || '';
                if (adf.content) {
                    text = '```' + lang + '\n' + adf.content.map(extractTextFromADF).join('') + '\n```\n\n';
                }
            } else if (adf.type === 'bulletList' || adf.type === 'orderedList') {
                if (adf.content) {
                    text = adf.content.map(item => {
                        const prefix = adf.type === 'bulletList' ? '- ' : '1. ';
                        return prefix + extractTextFromADF(item);
                    }).join('') + '\n';
                }
            } else if (adf.type === 'listItem') {
                if (adf.content) {
                    text = adf.content.map(extractTextFromADF).join('') + '\n';
                }
            } else if (adf.content) {
                // Recursively process content array
                text = adf.content.map(extractTextFromADF).join('');
            }

            return text;
        }

        // Convert markdown to HTML
        function markdownToHtml(markdown) {
            if (!markdown) return '';
            return marked.parse(markdown);
        }

        async function fetchIssues(q = "") {
            try {
                const url = q ? `/api/issues?q=${encodeURIComponent(q)}` : "/api/issues";
                const res = await fetch(url);
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                return await res.json();
            } catch (error) {
                console.error('Error fetching issues:', error);
                return [];
            }
        }

        async function fetchIssueDetail(key) {
            try {
                const res = await fetch(`/api/issue/${key}`);
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                const data = await res.json();
                return data;
            } catch (error) {
                console.error('Error fetching issue detail:', error);
                return { error: 'Failed to load issue details' };
            }
        }

        function formatIssueDetail(data) {
            if (data.error) {
                return `<div class="detail-section"><p style="color: var(--error-color);">Error: ${data.error}</p></div>`;
            }

            const issue = data.issue || data; // Handle both old and new format
            const customFields = data.custom_fields || [];
            const fields = issue.fields || {};
            const key = issue.key || 'Unknown';
            const summary = fields.summary || 'No summary';
            const description = fields.description || 'No description provided';
            const status = fields.status?.name || 'Unknown';
            const assignee = fields.assignee?.displayName || fields.assignee?.name || 'Unassigned';
            const reporter = fields.reporter?.displayName || fields.reporter?.name || 'Unknown';
            const priority = fields.priority?.name || 'Unknown';
            const issueType = fields.issuetype?.name || 'Unknown';
            const created = fields.created ? new Date(fields.created).toLocaleString() : 'Unknown';
            const updated = fields.updated ? new Date(fields.updated).toLocaleString() : 'Unknown';
            const labels = fields.labels || [];
            const components = fields.components || [];
            const fixVersions = fields.fixVersions || [];

            let html = `
                <div class="detail-section">
                    <h3>üìã Issue Information</h3>
                    <div class="detail-field">
                        <div class="detail-label">Key:</div>
                        <div class="detail-value"><strong><a href="#" class="issue-key" onclick="openIssueInTab('${key}'); return false;">${key}</a></strong></div>
                    </div>
                    <div class="detail-field">
                        <div class="detail-label">Type:</div>
                        <div class="detail-value">${issueType}</div>
                    </div>
                    <div class="detail-field">
                        <div class="detail-label">Status:</div>
                        <div class="detail-value"><span class="status-badge ${getStatusClass(status)}">${status}</span></div>
                    </div>
                    <div class="detail-field">
                        <div class="detail-label">Priority:</div>
                        <div class="detail-value">${priority}</div>
                    </div>
                    <div class="detail-field">
                        <div class="detail-label">Summary:</div>
                        <div class="detail-value"><strong>${summary}</strong></div>
                    </div>
                </div>

                <div class="detail-section">
                    <h3>üë• People</h3>
                    <div class="detail-field">
                        <div class="detail-label">Assignee:</div>
                        <div class="detail-value">
                            <div class="user-avatar">
                                <div class="avatar">${getUserInitials(assignee)}</div>
                                <span>${assignee}</span>
                            </div>
                        </div>
                    </div>
                    <div class="detail-field">
                        <div class="detail-label">Reporter:</div>
                        <div class="detail-value">
                            <div class="user-avatar">
                                <div class="avatar">${getUserInitials(reporter)}</div>
                                <span>${reporter}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h3>üìÖ Dates</h3>
                    <div class="detail-field">
                        <div class="detail-label">Created:</div>
                        <div class="detail-value">${created}</div>
                    </div>
                    <div class="detail-field">
                        <div class="detail-label">Updated:</div>
                        <div class="detail-value">${updated}</div>
                    </div>
                </div>
            `;

            if (labels.length > 0) {
                html += `
                    <div class="detail-section">
                        <h3>üè∑Ô∏è Labels</h3>
                        <div class="detail-labels">
                            ${labels.map(label => `<span class="label-tag">${label}</span>`).join('')}
                        </div>
                    </div>
                `;
            }

            if (components.length > 0) {
                html += `
                    <div class="detail-section">
                        <h3>üîß Components</h3>
                        <div class="detail-value">
                            ${components.map(comp => comp.name || comp).join(', ')}
                        </div>
                    </div>
                `;
            }

            if (fixVersions.length > 0) {
                html += `
                    <div class="detail-section">
                        <h3>üéØ Fix Versions</h3>
                        <div class="detail-value">
                            ${fixVersions.map(ver => ver.name || ver).join(', ')}
                        </div>
                    </div>
                `;
            }

            // Show custom fields if present
            if (customFields.length > 0) {
                let customFieldsHtml = '';
                customFields.forEach(cf => {
                    const fieldId = cf.field;
                    const fieldName = cf.name || fieldId;
                    const fieldType = cf.type || 'string';

                    if (fieldId && fields[fieldId]) {
                        let value = fields[fieldId];

                        // Handle different value types
                        if (Array.isArray(value)) {
                            value = value.map(v => {
                                if (typeof v === 'object' && v !== null) {
                                    return v.value || v.name || v.displayName || JSON.stringify(v);
                                }
                                return v;
                            }).filter(v => v).join(', ');
                        } else if (typeof value === 'object' && value !== null) {
                            value = value.value || value.name || value.displayName || JSON.stringify(value);
                        }

                        if (value) {
                            if (fieldType === 'text') {
                                customFieldsHtml += `
                                    <div class="detail-field">
                                        <div class="detail-label">${fieldName}:</div>
                                        <div class="detail-value">
                                            <div class="detail-description">${value}</div>
                                        </div>
                                    </div>
                                `;
                            } else if (fieldType === 'url') {
                                customFieldsHtml += `
                                    <div class="detail-field">
                                        <div class="detail-label">${fieldName}:</div>
                                        <div class="detail-value">
                                            <a href="${value}" class="detail-link" target="_blank">${value}</a>
                                        </div>
                                    </div>
                                `;
                            } else {
                                customFieldsHtml += `
                                    <div class="detail-field">
                                        <div class="detail-label">${fieldName}:</div>
                                        <div class="detail-value">${value}</div>
                                    </div>
                                `;
                            }
                        }
                    }
                });

                if (customFieldsHtml) {
                    html += `
                        <div class="detail-section">
                            <h3>üîß Fields</h3>
                            ${customFieldsHtml}
                        </div>
                    `;
                }
            }

            html += `
                <div class="detail-section">
                    <h3>üìù Description</h3>
                    <div class="detail-description">${markdownToHtml(convertJiraToMarkdown(description))}</div>
                </div>

                <button class="raw-json-toggle" onclick="toggleRawJson()">
                    üîç Show Raw JSON
                </button>
                <div class="raw-json" id="raw-json">${JSON.stringify(issue, null, 2)}</div>
            `;

            return html;
        }

        function toggleRawJson() {
            const rawJson = document.getElementById('raw-json');
            const button = document.querySelector('.raw-json-toggle');

            if (rawJson.style.display === 'none' || rawJson.style.display === '') {
                rawJson.style.display = 'block';
                button.textContent = 'üìã Hide Raw JSON';
            } else {
                rawJson.style.display = 'none';
                button.textContent = 'üîç Show Raw JSON';
            }
        }

        function getStatusClass(status) {
            const statusLower = status.toLowerCase();
            if (statusLower.includes('todo') || statusLower.includes('new') || statusLower.includes('open')) return 'status-todo';
            if (statusLower.includes('progress') || statusLower.includes('doing')) return 'status-progress';
            if (statusLower.includes('review') || statusLower.includes('qa')) return 'status-review';
            if (statusLower.includes('done') || statusLower.includes('closed') || statusLower.includes('resolved')) return 'status-done';
            return 'status-default';
        }

        function getUserInitials(name) {
            if (!name || name === 'None') return '?';
            return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
        }

        function formatDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }

        function renderTable(issues) {
            const tbody = document.getElementById('issues-tbody');

            if (issues.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="no-issues">No issues found</td></tr>';
                return;
            }

            tbody.innerHTML = issues.map((row, index) => `
                <tr onclick="selectRow(this, '${row[1]}')">
                    <td><span class="issue-type">${row[0]}</span></td>
                    <td><a href="#" class="issue-key">${row[1]}</a></td>
                    <td><div class="issue-summary" title="${row[2]}">${row[2]}</div></td>
                    <td><span class="status-badge ${getStatusClass(row[3])}">${row[3]}</span></td>
                    <td>
                        <div class="user-avatar">
                            <div class="avatar">${getUserInitials(row[4])}</div>
                            <span>${row[4]}</span>
                        </div>
                    </td>
                    <td>
                        <div class="user-avatar">
                            <div class="avatar">${getUserInitials(row[5])}</div>
                            <span>${row[5]}</span>
                        </div>
                    </td>
                    <td><span class="date">${formatDate(row[6])}</span></td>
                    <td><span class="date">${formatDate(row[7])}</span></td>
                </tr>
            `).join('');

            updateStats(issues.length);
        }

        function updateStats(count) {
            document.getElementById('stats').textContent = `${count} issue${count !== 1 ? 's' : ''}`;
        }

        async function selectRow(row, key) {
            // Remove previous selection
            if (selectedRow) {
                selectedRow.classList.remove('selected');
            }

            // Select new row
            selectedRow = row;
            row.classList.add('selected');

            // Show detail panel
            const detail = await fetchIssueDetail(key);
            showDetail(key, detail);
        }

        function showDetail(key, detail) {
            const panel = document.getElementById('detail-panel');
            panel.classList.remove('empty');

            panel.innerHTML = `
                <div class="detail-content">${formatIssueDetail(detail)}</div>
            `;
        }

        function closeDetail() {
            const panel = document.getElementById('detail-panel');
            panel.classList.add('empty');
            panel.innerHTML = `
                <div style="text-align: center; color: var(--text-muted);">
                    üìã Select an issue to view details
                </div>
            `;

            if (selectedRow) {
                selectedRow.classList.remove('selected');
                selectedRow = null;
            }
        }

        // Search functionality with debouncing
        let searchTimeout;
        document.getElementById('search').addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(async () => {
                const issues = await fetchIssues(e.target.value);
                renderTable(issues);
                closeDetail(); // Close detail panel when searching
            }, 300);
        });

        // Search toggle functionality
        function toggleSearchBar() {
            const searchContainer = document.querySelector('.search-container');
            const searchToggle = document.getElementById('search-toggle');
            const searchInput = document.getElementById('search');

            if (searchContainer.classList.contains('visible')) {
                // Hide search
                searchContainer.classList.remove('visible');
                searchToggle.classList.remove('active');
                searchToggle.title = 'Show search (Press /)';

                // Clear search if hiding
                if (searchInput.value.trim()) {
                    searchInput.value = '';
                    // Trigger search to show all issues
                    fetchIssues().then(issues => renderTable(issues));
                    closeDetail();
                }
            } else {
                // Show search
                searchContainer.classList.add('visible');
                searchToggle.classList.add('active');
                searchToggle.title = 'Hide search (Press /)';

                // Focus on search input after animation
                setTimeout(() => {
                    searchInput.focus();
                }, 200);
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Don't trigger shortcuts when typing in input fields
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                return;
            }

            if (e.key === 'Escape') {
                // Close help overlay first, then board modal, then search, then detail panel
                const helpOverlay = document.getElementById('help-overlay');
                const boardModal = document.getElementById('board-modal');
                const searchContainer = document.querySelector('.search-container');
                if (helpOverlay && helpOverlay.style.display !== 'none') {
                    hideHelpOverlay();
                } else if (boardModal) {
                    hideBoardSelector();
                } else if (searchContainer && searchContainer.classList.contains('visible')) {
                    toggleSearchBar();
                } else {
                    closeDetail();
                }
            } else if (e.key.toLowerCase() === 't') {
                e.preventDefault();
                toggleViewState();
            } else if (e.key.toLowerCase() === 'v') {
                e.preventDefault();
                toggleLayoutState();
            } else if (e.key.toLowerCase() === 'b') {
                e.preventDefault();
                showBoardSelector();
            } else if (e.key === '/') {
                e.preventDefault();
                toggleSearchBar();
            } else if (e.key === 'j') {
                e.preventDefault();
                navigateIssueList('down');
            } else if (e.key === 'k') {
                e.preventDefault();
                navigateIssueList('up');
            } else if (e.key === 'J') {
                e.preventDefault();
                scrollDetailPanel('down');
            } else if (e.key === 'K') {
                e.preventDefault();
                scrollDetailPanel('up');
            } else if (e.key === 'o' || e.key === 'O') {
                e.preventDefault();
                openSelectedIssueInNewTab();
            } else if (e.key === 'y' || e.key === 'Y') {
                e.preventDefault();
                yankIssueUrl();
            } else if (e.key === '?') {
                e.preventDefault();
                showHelpOverlay();
            } else if (e.key === 'Home') {
                e.preventDefault();
                navigateToFirstIssue();
            } else if (e.key === 'End') {
                e.preventDefault();
                navigateToLastIssue();
            } else if (e.key === 'PageUp') {
                e.preventDefault();
                if (e.shiftKey) {
                    scrollDetailPanelPage('up');
                } else {
                    navigatePageUp();
                }
            } else if (e.key === 'PageDown') {
                e.preventDefault();
                if (e.shiftKey) {
                    scrollDetailPanelPage('down');
                } else {
                    navigatePageDown();
                }
            } else if (e.key === ' ') {
                e.preventDefault();
                if (e.shiftKey) {
                    scrollDetailPanelPage('up');
                } else {
                    scrollDetailPanelPage('down');
                }
            } else if (e.key === '/') {
                e.preventDefault();
                toggleSearchBar();
            }
        });

        // View toggle event listener
        document.getElementById('view-toggle').addEventListener('click', toggleViewState);

        // Layout toggle event listener
        document.getElementById('layout-toggle').addEventListener('click', toggleLayoutState);

        // Search toggle event listener
        document.getElementById('search-toggle').addEventListener('click', toggleSearchBar);

        // Board selector event listener
        document.getElementById('board-selector').addEventListener('click', showBoardSelector);

        // Board management functions
        async function loadBoards() {
            try {
                const res = await fetch('/api/boards');
                if (res.ok) {
                    const data = await res.json();
                    availableBoards = data.boards || [];
                    updateBoardSelectorText();
                }
            } catch (error) {
                console.error('Error loading boards:', error);
            }
        }

        function updateBoardSelectorText() {
            const selector = document.getElementById('board-selector');
            if (currentBoard && selector) {
                selector.textContent = `üìã ${currentBoard}`;
            } else if (selector) {
                selector.textContent = 'üìã Board';
            }
        }

        function showBoardSelector() {
            if (availableBoards.length === 0) {
                showNotification('No boards configured', 'error');
                return;
            }

            // Remove existing modal if it exists
            const existingModal = document.getElementById('board-modal');
            if (existingModal) {
                existingModal.remove();
            }

            // Create board selection modal
            const modal = document.createElement('div');
            modal.id = 'board-modal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background-color: rgba(0, 0, 0, 0.7);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                animation: fadeIn 0.2s ease;
            `;

            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: #ffffff;
                color: #333333;
                border: 1px solid #e1e4e8;
                border-radius: 8px;
                padding: 1.5rem;
                max-width: 400px;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                margin: 1rem;
                min-width: 300px;
            `;

            let boardsHtml = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; border-bottom: 1px solid #e1e4e8; padding-bottom: 1rem;">
                    <h3 style="margin: 0; color: #0366d6; font-size: 1.1rem;">üìã Select Board</h3>
                    <button id="close-board-modal" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #6a737d; padding: 0.25rem;">&times;</button>
                </div>
                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
            `;

            availableBoards.forEach((board, index) => {
                const isSelected = board.name === currentBoard;
                boardsHtml += `
                    <button class="board-option" data-board-name="${board.name}" style="
                        background: ${isSelected ? '#f1f8ff' : '#ffffff'};
                        border: 1px solid ${isSelected ? '#0366d6' : '#e1e4e8'};
                        border-radius: 6px;
                        padding: 0.75rem;
                        cursor: pointer;
                        text-align: left;
                        transition: all 0.2s ease;
                        color: ${isSelected ? '#0366d6' : '#24292e'};
                    ">
                        <div style="font-weight: 600; margin-bottom: 0.25rem;">${board.name} ${isSelected ? '‚úì' : ''}</div>
                        <div style="font-size: 0.875rem; color: #6a737d;">${board.description}</div>
                    </button>
                `;
            });

            boardsHtml += '</div>';
            modalContent.innerHTML = boardsHtml;
            modal.appendChild(modalContent);
            document.body.appendChild(modal);

            // Add event listeners
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    hideBoardSelector();
                }
            });

            document.getElementById('close-board-modal').addEventListener('click', hideBoardSelector);

            // Add click handlers for board options
            modalContent.querySelectorAll('.board-option').forEach(button => {
                button.addEventListener('click', () => {
                    const boardName = button.getAttribute('data-board-name');
                    switchToBoard(boardName);
                });

                button.addEventListener('mouseenter', () => {
                    if (!button.style.backgroundColor.includes('f1f8ff')) {
                        button.style.backgroundColor = '#f6f8fa';
                        button.style.borderColor = '#d1d5da';
                    }
                });

                button.addEventListener('mouseleave', () => {
                    if (!button.style.backgroundColor.includes('f1f8ff')) {
                        button.style.backgroundColor = '#ffffff';
                        button.style.borderColor = '#e1e4e8';
                    }
                });
            });
        }

        function hideBoardSelector() {
            const modal = document.getElementById('board-modal');
            if (modal) {
                modal.remove();
            }
        }

        async function switchToBoard(boardName) {
            try {
                hideBoardSelector();
                showNotification(`üîÑ Switching to ${boardName}...`, 'info');

                const res = await fetch(`/api/boards/${encodeURIComponent(boardName)}/switch`, {
                    method: 'POST'
                });

                if (!res.ok) {
                    throw new Error(`HTTP ${res.status}`);
                }

                const result = await res.json();
                currentBoard = boardName;
                updateBoardSelectorText();

                // Reload issues
                allIssues = await fetchIssues();
                renderTable(allIssues);
                closeDetail();

                showNotification(`‚úÖ Switched to ${boardName} (${result.issue_count} issues)`, 'success');
            } catch (error) {
                console.error('Error switching board:', error);
                showNotification(`‚ùå Failed to switch to ${boardName}`, 'error');
            }
        }

        // Initial load
        async function init() {
            initializeViewState();
            initializeLayoutState();
            await loadConfig(); // Load Jira base URL
            await loadBoards(); // Load available boards

            // Try to detect current board from first board in config or use default
            if (availableBoards.length > 0) {
                currentBoard = availableBoards[0].name;
                updateBoardSelectorText();
            }

            allIssues = await fetchIssues();
            renderTable(allIssues);
        }

        init();

        // Additional navigation functions for Page Up/Down, Home/End
        function navigateToFirstIssue() {
            const tbody = document.getElementById('issues-tbody');
            const firstRow = tbody.querySelector('tr:not(.loading):not(.no-issues)');
            if (firstRow) {
                const keyCell = firstRow.querySelector('td:nth-child(2) a');
                if (keyCell) {
                    const issueKey = keyCell.textContent.trim();
                    selectRow(firstRow, issueKey);
                    firstRow.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            }
        }

        function navigateToLastIssue() {
            const tbody = document.getElementById('issues-tbody');
            const rows = Array.from(tbody.querySelectorAll('tr')).filter(row =>
                !row.querySelector('.loading') && !row.querySelector('.no-issues')
            );
            const lastRow = rows[rows.length - 1];
            if (lastRow) {
                const keyCell = lastRow.querySelector('td:nth-child(2) a');
                if (keyCell) {
                    const issueKey = keyCell.textContent.trim();
                    selectRow(lastRow, issueKey);
                    lastRow.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            }
        }

        function navigatePageUp() {
            const tbody = document.getElementById('issues-tbody');
            const rows = Array.from(tbody.querySelectorAll('tr')).filter(row =>
                !row.querySelector('.loading') && !row.querySelector('.no-issues')
            );

            if (rows.length === 0) return;

            let currentIndex = -1;
            if (selectedRow) {
                currentIndex = rows.findIndex(row => row === selectedRow);
            }

            // If no selection, start from the end when going up
            if (currentIndex === -1) {
                currentIndex = rows.length;
            }

            // Move up by ~10 rows (or to beginning if less than 10)
            const pageSize = Math.min(10, rows.length);
            let newIndex = Math.max(0, currentIndex - pageSize);

            const newRow = rows[newIndex];
            if (newRow) {
                const keyCell = newRow.querySelector('td:nth-child(2) a');
                if (keyCell) {
                    const issueKey = keyCell.textContent.trim();
                    selectRow(newRow, issueKey);
                    newRow.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            }
        }

        function navigatePageDown() {
            const tbody = document.getElementById('issues-tbody');
            const rows = Array.from(tbody.querySelectorAll('tr')).filter(row =>
                !row.querySelector('.loading') && !row.querySelector('.no-issues')
            );

            if (rows.length === 0) return;

            let currentIndex = -1;
            if (selectedRow) {
                currentIndex = rows.findIndex(row => row === selectedRow);
            }

            // If no selection, start from the beginning when going down
            if (currentIndex === -1) {
                currentIndex = -1;
            }

            // Move down by ~10 rows (or to end if less than 10)
            const pageSize = Math.min(10, rows.length);
            let newIndex = Math.min(rows.length - 1, currentIndex + pageSize);

            const newRow = rows[newIndex];
            if (newRow) {
                const keyCell = newRow.querySelector('td:nth-child(2) a');
                if (keyCell) {
                    const issueKey = keyCell.textContent.trim();
                    selectRow(newRow, issueKey);
                    newRow.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            }
        }

        function scrollDetailPanelPage(direction) {
            const detailContent = document.querySelector('.detail-content');
            if (!detailContent) return;

            const containerHeight = detailContent.clientHeight;
            const scrollAmount = containerHeight * 0.8; // Scroll 80% of visible area
            const currentScroll = detailContent.scrollTop;

            if (direction === 'down') {
                detailContent.scrollTo({
                    top: currentScroll + scrollAmount,
                    behavior: 'smooth'
                });
            } else {
                detailContent.scrollTo({
                    top: Math.max(0, currentScroll - scrollAmount),
                    behavior: 'smooth'
                });
            }
        }
    </script>
</body>

</html>